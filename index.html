<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>Simple Cache Header Checker</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            background: #0f172a;
            color: #e5e7eb;
        }

        .container {
            max-width: 700px;
            margin: 0 auto;
            padding: 20px 18px 24px;
            background: #020617;
            border-radius: 10px;
            border: 1px solid #1f2937;
        }

        h1 {
            margin: 0 0 4px;
            font-size: 22px;
        }

        p {
            margin: 0 0 14px;
            font-size: 13px;
            color: #9ca3af;
        }

        label {
            display: block;
            font-size: 12px;
            margin-bottom: 4px;
        }

        input[type="text"] {
            width: 100%;
            padding: 8px 10px;
            border-radius: 6px;
            border: 1px solid #4b5563;
            font-size: 13px;
            background: #020617;
            color: #e5e7eb;
        }

        input[type="text"]::placeholder {
            color: #6b7280;
        }

        button {
            margin-top: 10px;
            padding: 8px 14px;
            border-radius: 6px;
            border: none;
            background: #3b82f6;
            color: white;
            font-size: 13px;
            cursor: pointer;
        }

        button:disabled {
            opacity: 0.6;
            cursor: default;
        }

        .error {
            margin-top: 8px;
            color: #fecaca;
            font-size: 12px;
        }

        .section {
            margin-top: 16px;
            padding-top: 10px;
            border-top: 1px solid #1f2937;
        }

        .section-title {
            font-size: 13px;
            margin-bottom: 6px;
            font-weight: 600;
        }

        dl {
            margin: 0;
            font-size: 13px;
        }

        dt {
            font-weight: 500;
            margin-top: 6px;
        }

        dd {
            margin: 2px 0 0 0;
            color: #d1d5db;
            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
            font-size: 12px;
        }

        pre {
            margin: 6px 0 0;
            padding: 8px;
            background: #020617;
            border-radius: 6px;
            border: 1px solid #1f2937;
            max-height: 200px;
            overflow: auto;
            font-size: 12px;
            white-space: pre-wrap;
            word-break: break-all;
        }

        .small {
            font-size: 12px;
            color: #9ca3af;
            margin-top: 4px;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>Cache Header Checker</h1>
        <p>Enter a URL and see if it has cache headers, how long they last, and when it expires.</p>

        <label for="url">URL</label>
        <input id="url" type="text" placeholder="https://example.com" />
        <button id="check">Check cache headers</button>
        <div id="error" class="error" style="display:none;"></div>

        <div class="section">
            <div class="section-title">Summary</div>
            <dl>
                <dt>Has cache headers?</dt>
                <dd id="has-cache">–</dd>

                <dt>Cache-Control</dt>
                <dd id="cache-control">–</dd>

                <dt>Max-age (seconds)</dt>
                <dd id="max-age">–</dd>

                <dt>Expires at</dt>
                <dd id="expires-at">–</dd>

                <dt>Approximate lifetime</dt>
                <dd id="lifetime">–</dd>
            </dl>
            <div class="small">Note: Calculations are based on what the browser can see. CORS may block some responses.
            </div>
        </div>

        <div class="section">
            <div class="section-title">Raw response headers</div>
            <pre id="raw-headers">(no request yet)</pre>
        </div>
    </div>

    <script>
        const urlInput = document.getElementById("url");
        const checkBtn = document.getElementById("check");
        const errorEl = document.getElementById("error");

        const hasCacheEl = document.getElementById("has-cache");
        const cacheControlEl = document.getElementById("cache-control");
        const maxAgeEl = document.getElementById("max-age");
        const expiresAtEl = document.getElementById("expires-at");
        const lifetimeEl = document.getElementById("lifetime");
        const rawHeadersEl = document.getElementById("raw-headers");

        function showError(msg) {
            if (!msg) {
                errorEl.style.display = "none";
                errorEl.textContent = "";
                return;
            }
            errorEl.style.display = "block";
            errorEl.textContent = msg;
        }

        function normalizeUrl(raw) {
            let value = (raw || "").trim();
            if (!value) return "";
            if (!/^https?:\/\//i.test(value)) {
                value = "https://" + value;
            }
            try {
                return new URL(value).toString();
            } catch {
                return "";
            }
        }

        function parseMaxAge(cacheControl) {
            if (!cacheControl) return null;
            const parts = cacheControl.split(",").map(p => p.trim());
            for (const part of parts) {
                const [key, val] = part.split("=");
                if (key.toLowerCase() === "max-age" && val !== undefined) {
                    const n = Number(val);
                    if (Number.isFinite(n)) return n;
                }
            }
            return null;
        }

        function formatDuration(sec) {
            if (sec == null || !isFinite(sec)) return "";
            if (sec < 0) sec = 0;
            const s = Math.floor(sec);
            if (s === 0) return "0 seconds";
            const days = Math.floor(s / 86400);
            const hours = Math.floor((s % 86400) / 3600);
            const minutes = Math.floor((s % 3600) / 60);
            const parts = [];
            if (days) parts.push(days + " day" + (days !== 1 ? "s" : ""));
            if (hours) parts.push(hours + " hour" + (hours !== 1 ? "s" : ""));
            if (minutes) parts.push(minutes + " minute" + (minutes !== 1 ? "s" : ""));
            if (!parts.length) parts.push(s + " second" + (s !== 1 ? "s" : ""));
            return parts.join(", ");
        }

        async function checkCache() {
            showError("");

            const url = normalizeUrl(urlInput.value);
            if (!url) {
                showError("Please enter a valid URL (for example: https://example.com).");
                return;
            }

            hasCacheEl.textContent = "–";
            cacheControlEl.textContent = "–";
            maxAgeEl.textContent = "–";
            expiresAtEl.textContent = "–";
            lifetimeEl.textContent = "–";
            rawHeadersEl.textContent = "Loading...";

            checkBtn.disabled = true;

            try {
                const res = await fetch(url, { method: "HEAD" });

                const headers = [];
                res.headers.forEach((value, key) => {
                    headers.push(key + ": " + value);
                });
                headers.sort((a, b) => a.localeCompare(b));
                rawHeadersEl.textContent = headers.join("\n") || "(no headers visible)";

                const cacheControl = res.headers.get("cache-control");
                const expires = res.headers.get("expires");

                const hasAnyCacheHeader = !!(cacheControl || expires);
                hasCacheEl.textContent = hasAnyCacheHeader ? "Yes" : "No";

                cacheControlEl.textContent = cacheControl || "(none)";

                let maxAge = parseMaxAge(cacheControl);
                maxAgeEl.textContent = maxAge != null ? String(maxAge) : "(not set)";

                let expiresDate = null;
                if (expires) {
                    const d = new Date(expires);
                    if (!isNaN(d.getTime())) {
                        expiresDate = d;
                        expiresAtEl.textContent = d.toString();
                    } else {
                        expiresAtEl.textContent = "Invalid Expires header: " + expires;
                    }
                } else {
                    expiresAtEl.textContent = "(not set)";
                }

                let lifetimeSeconds = null;
                if (maxAge != null) {
                    lifetimeSeconds = maxAge;
                } else if (expiresDate) {
                    const diffMs = expiresDate.getTime() - Date.now();
                    lifetimeSeconds = diffMs / 1000;
                }

                if (lifetimeSeconds != null && isFinite(lifetimeSeconds)) {
                    lifetimeEl.textContent = formatDuration(lifetimeSeconds);
                } else {
                    lifetimeEl.textContent = "Unknown (no max-age or valid Expires header)";
                }
            } catch (err) {
                console.error(err);
                showError("Could not read headers. The site may block cross-origin requests (CORS) or be unreachable.");
                rawHeadersEl.textContent = "(no headers – request failed or was blocked)";
            } finally {
                checkBtn.disabled = false;
            }
        }

        checkBtn.addEventListener("click", checkCache);
        urlInput.addEventListener("keydown", (e) => {
            if (e.key === "Enter") {
                e.preventDefault();
                checkCache();
            }
        });
    </script>
</body>

</html>